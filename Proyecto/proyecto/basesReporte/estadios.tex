%%%%%----------------------------------------
%%%%%--------------------------------------
%%%%%-------------------------------------
\section{\texttt{Estadios}}
%%%%%-------------------------------------
%%%%%--------------------------------------
%%%%%----------------------------------------

La FIFA nos ha encargado el desarrollo de un sistema para la administración de la venta de boletos
en estadios de fútbol para los partidos del Mundial de 2026. El sistema deberá cubrir los cuatro
estadios de fútbol de México que albergarán partidos del torneo: el Estadio Azteca,
el Estadio Corregidora, el Estadio Hidalgo y el Estadio Jalisco.

%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Lista de Requerimientos}
%%%%%-------------------------------------
%%%%%--------------------------------------


%%%%%-------------------------------------
\subsubsection*{Datos para la base de datos:}
%%%%%-------------------------------------

\begin{itemize}
    \item Nombre de los 4 estadios
    \begin{itemize}
        \item Estadio Azteca      $\{$ Capacidad: 83,000, \\
                                       Ubicación: Calzada de Tlalpan 3465, Sta. Úrsula Coapa, Coyoacán, 04650 Ciudad de México, CDMX,\\
                                       Precio de las secciones: Cabecera Local: 300, Cabecera Visita: 300, Lateral Visita: 400, Lateral Local: 450, Palcos: 1500
                                       Asientos de las secciones: Cabecera Local: 20,750, Cabecera Visita: 16,600, Lateral Visita: 12,450, Lateral Local: 20,750, Palcos: 12,450
                                  $\}$
        \item Estadio Corregidora $\{$ Capacidad: 34,000, \\
                                       Ubicación: Avenidas de las Torres S/N, Centro Sur, 76090 Santiago de Querétaro, Qro.,\\
                                       Precio de las secciones: Cabecera Local: 250, Cabecera Visita: 250, Lateral Visita: 300, Lateral Local 300, Palcos 900
                                       Asientos de las secciones: Cabecera Local: 8,500, Cabecera Visita: 6,800, Lateral Visita: 5,100, Lateral Local: 8,500, Palcos: 5,100
                                  $\}$        
        \item Estadio Hidalgo     $\{$ Capacidad: 30,000, \\
                                       Ubicación: 2da B Juárez 102, Los Jales, Ex Hacienda de Coscotitlán, 42064 Pachuca de Soto, Hgo.,\\
                                       Precio de las secciones: Cabecera Local: 250, Cabecera Visita: 250, Lateral Visita: 300, Lateral Local 300, Palcos 1000
                                       Asientos de las secciones: Cabecera Local: 7,500, Cabecera Visita: 6,000, Lateral Visita: 4,500, Lateral Local: 7,500, Palcos: 4,500
                                       
                                  $\}$        
        \item Estadio Jalisco     $\{$ Capacidad: 55,000, \\
                                       Ubicación: C. Siete Colinas 1772, Independencia, 44290 Guadalajara, Jal.,\\
                                       Precio de las secciones: Cabecera Local: 270, Cabecera Visita: 270, Lateral Visita: 350, Lateral Local 400, Palcos 1200
                                       Asientos de las secciones: Cabecera Local: 13,750, Cabecera Visita: 11,000, Lateral Visita: 8,250, Lateral Local: 13,750, Palcos: 8,250
                                  $\}$           
    \end{itemize}
    %IMPORTANTE: CADA TOTAL DE ASIENTOS POR SECCIÓN se divide entre 10 letras para obtener una numeración como la siguiente: CLA1, CLA1, ... CLB1, ... etc
    %DODE CL: es la sección, A: es la letra de numeración (va de A a la J) y la numeración de los boletos correspondientes 
\end{itemize}

\subsubsection*{Restricciones de los datos}

\begin{itemize}
    \item El número de boleto, el nombre del estadio, el nombre de la sección (dentro de un estadio), el número de transacción, el nombre del equipo y el id del partido deben ser únicos.
    \item Las fechas del partido y de la transacción deben ser válidas.
    \item La fecha y hora del partido deben estar en el futuro.
    \item El estadio debe ser uno de los cuatro estadios de México.
    \item La sección y el asiento deben ser válidos dentro del estadio.
    \item El precio y la capacidad del estadio y de la sección deben ser números positivos.
    \item El estado de venta debe ser Vendido o Disponible.
    \item El nombre y la dirección del cliente, así como el país del equipo, deben ser cadenas no vacías.
    \item El teléfono del cliente y el número de tarjeta de crédito deben ser válidos.
    \item El correo electrónico del cliente debe ser una dirección de correo electrónico válida.
    \item La ubicación del estadio debe ser una cadena que describa la ciudad o lugar donde se encuentra.
    \item Debe haber al menos una sección asociada a cada estadio y al menos dos equipos participando en cada partido.
    \item El estadio asociado al partido y el cliente y el boleto asociados a la transacción deben existir en sus respectivas tablas.
    \item El precio en la transacción debe ser igual al precio del boleto multiplicado por la cantidad de boletos en la transacción.
    \item El id del equipo en el partido debe hacer referencia a un equipo existente en la tabla Equipos.
    \item El id del partido en el equipo partido debe hacer referencia a un partido existente en la tabla Partido.
    \item La combinación única de id del equipo y id del partido debe asegurar que un equipo no participe más de una vez en el mismo partido.
\end{itemize}



%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Modelo conceptual}
%%%%%-------------------------------------
%%%%%--------------------------------------
\begin{center}
    \includegraphics[scale = .6]{IMA/estadio/BD-ESTADIO-MO-CONCEPTUAL.png}
\end{center}


%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Modelo relacional}
%%%%%-------------------------------------
%%%%%--------------------------------------
\begin{center}
    \includegraphics[scale = .7]{IMA/estadio/BD-ESTADIO-MO-RELACIONAL.png}
\end{center}


%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Script de creación}
%%%%%-------------------------------------
%%%%%--------------------------------------

\begin{itemize}
    \item[$\rightarrow$] Script completo y sin errores para la creación de todos los elementos que conforman el esquema
            de la base de datos.
    \item[$\rightarrow$] El Script debe estar diseñado para la versión 14 de Postgres.
    \item[$\rightarrow$] Deben estar contempladas todas las llaves primarias, llaves candidatas y llaves foráneas;
    todas las llaves foráneas deben contar con un trigger de integridad referencial (SET NULL,
    CASCADE o SET DEFAULT).
\end{itemize}


\begin{lstlisting}[caption={Tablas para la BdDatos}, label={lst:sql_estadios}]
    -- Solo los titulos de las tablas    
    CREATE TABLE Clientes(

    );

    CREATE TABLE Estadios(

    );

    CREATE TABLE SeccionesEstadio(

    );

    CREATE TABLE Equipos(

    );

    CREATE TABLE Partidos(

    );

    CREATE TABLE Boletos (

    );

    CREATE TABLE Transacciones(

    );
\end{lstlisting}

    
%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Script de Insert}
%%%%%-------------------------------------
%%%%%--------------------------------------
\begin{itemize}
    \item[$\rightarrow$] Se deben generar 100 registros para cada tabla.
    \item[$\rightarrow$] Si para el buen funcionamiento de la base de datos se requieren más de 100 registros o
            menos de 100 registros en una tabla, se debe explicar claramente la razón, sólo en este caso
            sí se debe incluir un apartado en el reporte final.
\end{itemize}

Tablas:
\begin{itemize}
    \item Clientes: Si es posible llegar a 100 registros 
    \item Estadios: La tabla únicamente contiene la información de los 4 estadios que albergan el mundial, por lo que no es posible llegar a 100 registros
    \item SeccionesEstadio: Si es posible llegar a 100 registros 
    \item Equipos: La tabla únicamente contiene la información de las 32 selecciones clasificadas al mundial por lo que no es posible llegar a 100 registros
    \item Partidos: La tabla solo contiene los 24 partidos de fase de grupos por lo que no es posible llegar a 100 registros
    \item Boletos: Si es posible llegar a 100 registros 
    \item Transacciones: Si es posible llegar a 100 registros 
\end{itemize}


%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Funcionamiento restricciones}
%%%%%-------------------------------------
%%%%%--------------------------------------

Evidencia del funcionamiento de al menos 4 restricciones de integridad referencial.

\subsubsection*{Restricción 01}

\begin{itemize}
    \item[$\rightarrow$] Tablas involucradas en la restricción: Partidos y Estadios
    \item[$\rightarrow$] FK de la tabla que referencia y PK de la tabla referenciada: FK: id Estadio en la tabla Partidos. PK id Estadio en la tabla Estadios
    \item[$\rightarrow$] Justificación del trigger de integridad referencial elegido: : Esta restricción asegura que no puedes tener un partido en un estadio que no exista en la tabla Estadios.
    \item[$\rightarrow$] Instrucción UPDATE o DELETE que permita evidenciar que la restricción está
    funcionando.
    \begin{verbatim}
        DELETE FROM Estadios WHERE id_Estadio = 1;
    \end{verbatim}
    \item[$\rightarrow$] Captura de pantalla con el resultado de la instrucción que muestre que la restricción está
    funcionando.
    \begin{center}
        \includegraphics[scale = .4]{IMA/estadio/6-01.png}
    \end{center}
\end{itemize}


\subsubsection*{Restricción 02}

\begin{itemize}
    \item[$\rightarrow$] Tablas involucradas en la restricción: Boletos y Equipos
    \item[$\rightarrow$] FK de la tabla que referencia y PK de la tabla referenciada: Las claves foráneas en Boletos que hacen referencia a Equipos son id equipoLocal y id equipoVisita, y la clave primaria en Equipos es id Equipo.
    \item[$\rightarrow$] Justificación del trigger de integridad referencial elegido: Se utiliza la opción ON DELETE SET NULL. Esto significa que si se elimina un registro en la tabla Equipos, entonces el id equipoLocal y/o id equipoVisita correspondiente en la tabla Boletos se establecerá en NULL. Esto asegura la integridad de los datos.
    \item[$\rightarrow$] Instrucción UPDATE o DELETE que permita evidenciar que la restricción está
    funcionando.
    \begin{verbatim}
        DELETE FROM Equipos WHERE id_Equipo = 'SEN';
    \end{verbatim}
    \item[$\rightarrow$] Captura de pantalla con el resultado de la instrucción que muestre que la restricción está
    funcionando.
    \begin{center}
        \includegraphics[scale = .4]{IMA/estadio/6-02-1.png}

        \includegraphics[scale = .4]{IMA/estadio/6-02-2.png}
    \end{center}
\end{itemize}



\subsubsection*{Restricción 03}

\begin{itemize}
    \item[$\rightarrow$] Tablas involucradas en la restricción: Transacciones y Clientes
    \item[$\rightarrow$] FK de la tabla que referencia y PK de la tabla referenciada: La clave foránea en Transacciones que hace referencia a Clientes es id Cliente, y la clave primaria en Clientes es id Cliente.
    \item[$\rightarrow$] Justificación del trigger de integridad referencial elegido:  Se utiliza la opción ON DELETE CASCADE. Esto significa que si se elimina un registro en la tabla Clientes, entonces todos los registros correspondientes en la tabla Transacciones también se eliminarán. Esto asegura la integridad de los datos. 
    \item[$\rightarrow$] Instrucción UPDATE o DELETE que permita evidenciar que la restricción está
    funcionando.
    \begin{verbatim}
        DELETE FROM Clientes WHERE id_Cliente = 'CLI100';
    \end{verbatim}
    \item[$\rightarrow$] Captura de pantalla con el resultado de la instrucción que muestre que la restricción está
    funcionando.
    \begin{center}
        \includegraphics[scale = .4]{IMA/estadio/6-03-1.png}

        \includegraphics[scale = .4]{IMA/estadio/6-03-2.png}
    \end{center}
\end{itemize}


\subsubsection*{Restricción 04}

\begin{itemize}
    \item[$\rightarrow$] Tablas involucradas en la restricción: Transacciones y Boletos
    \item[$\rightarrow$] FK de la tabla que referencia y PK de la tabla referenciada: La clave foránea en Transacciones que hace referencia a Boletos es id Boleto, y la clave primaria en Boletos es num boleto.
    \item[$\rightarrow$] Justificación del trigger de integridad referencial elegido: Se utiliza la opción ON DELETE CASCADE. Esto significa que si se elimina un registro en la tabla Boletos, entonces todos los registros correspondientes en la tabla Transacciones también se eliminarán. Esto asegura la integridad de los datos.
    \item[$\rightarrow$] Instrucción UPDATE o DELETE que permita evidenciar que la restricción está
    funcionando.
    \begin{verbatim}
        DELETE FROM Boletos WHERE num_boleto = 2;
    \end{verbatim}
    \item[$\rightarrow$] Captura de pantalla con el resultado de la instrucción que muestre que la restricción está
    funcionando.
    \begin{center}
        \includegraphics[scale = .4 ]{IMA/estadio/6-04-1.png}

        \includegraphics[scale = .4 ]{IMA/estadio/6-04-2.png}
    \end{center}
\end{itemize}


%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Funcionamiento Restricciones check}
%%%%%-------------------------------------
%%%%%--------------------------------------

Evidencia del funcionamiento de al menos 3 restricciones check para “atributos” de varias
tablas.

\begin{itemize}
    \item Tabla elegida
    \item Atributo elegido
    \item Breve descripción de la restricción
    \item Instrucción para la creación de la restricción.
    \item Instrucción que permita evidenciar que la restricción esta funcionando.
    \item Captura de pantalla con el resultado de la instrucción que muestre que la restricción está
    funcionando.
\end{itemize}






%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Creación de dominios personalizados}
%%%%%-------------------------------------
%%%%%--------------------------------------

Evidencia de la creación de al menos tres dominios personalizados. Se deben utilizar restricciones check en la creación de los tres dominios.
\begin{itemize}
    \item Tabla elegida
    \item Atributo elegido
    \item Breve descripción del dominio y de la restricción check propuesta.
    \item Instrucción para la creación del dominio personalizado.
    \item Captura de pantalla de la estructura de la tabla donde se muestre el dominio personalizado
    en uso.
\end{itemize}



%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Restricciones para tuplas}
%%%%%-------------------------------------
%%%%%--------------------------------------

Evidencia del funcionamiento de al menos 2 restricciones para “tuplas” en diferentes tablas (Unidad 8 Integridad, tema Specifying Constraints on Tuples Using CHECK)
\begin{itemize}
    \item Tabla elegida
    \item Breve descripción de la restricción.
    \item Instrucción para la creación de la restricción.
    \item Instrucción Insert o Update que permita evidenciar que la restricción esta funcionando.
    \item Captura de pantalla con el resultado de la instrucción que muestre que la restricción está
    funcionando.
\end{itemize}



%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Consultas}
%%%%%-------------------------------------
%%%%%--------------------------------------

Plantea 3 consultas que consideres relevantes para la base de datos propuesta. Para cada consulta planteada, incluir en el reporte los siguientes incisos:
\begin{itemize}
    \item Redacción clara de la consulta.
    \item Código en lenguaje SQL de la consulta.
    \item Ejecutar la consulta en Postgres e incluir una captura de pantalla con el resultado de la
    consulta.
\end{itemize}

%%%%%--------------------------------------
%%%%%-------------------------------------
\subsection{Vistas}
%%%%%-------------------------------------
%%%%%--------------------------------------

Plantea 3 vistas que consideres relevantes para la base de datos propuesta. Para cada vista planteada, incluir en el reporte los siguientes incisos:
\begin{itemize}
    \item Redacción clara de la vista planteada.
    \item Código en lenguaje SQL que permita crear la vista solicitada.
    \item Ejecutar el código para la creación de la vista en Postgres e incluir una captura de pantalla
    con la vista creada satisfactoriamente.
    \item Incluir un ejemplo que los evaluadores puedan ejecutar para verificar el funcionamiento
    de las vistas.
\end{itemize}